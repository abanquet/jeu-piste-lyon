<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeu de Piste Historique à Lyon</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <header>
        <img src="logo_lyon_express.png" alt="Lyon Express Logo">
        <nav>
            <p>
                <p><a href="index.html">Français</a></p>
                <p><a href="index_en.html">English</a></p>
            </p>
        </nav>
    </header>
    <main>
        <section id="fr">
            <p>Préparez-vous à partir à la découverte de Lyon! Votre mission: résoudre des énigmes pour vous rendre dans les lieux emblématiques de la ville et partir sur les traces des personnages ayant marqué l'histoire de la ville.</p>
            
            <h2>Règles</h2>
            <p>Le jeu se fait par équipes de 4 à 5 personnes. Vous recevrez un QR codes de départ avec une première énigme</p>
            <p>À chaque étape, vous devrez :</p>
            <ul>
                <li>Résoudre une énigme pour deviner un lieu et parfois un personnage ayant marqué l'histoire de la ville</li>
                <li>Vous rendre sur place</li>
                <li>Scanner un nouveau QR code qui vous délivrera la suite</li>
            </ul>
            <p>Vous allez passer par 9 lieux différents et devoir deviner l'identité de 6 personnages historiques. Retenez bien la liste des personnages car ça vous sera utile pour l'étape finale!</p>

            <h2>Objectif</h2>
            <p>Vous devez être la première équipe à résoudre toutes les énigmes et à me rejoindre sur le lieu final!</p>
            <p>Pour ne pas vous perdre, voici une carte délimitant la zone où se trouvent les différents lieux à découvrir.</p>
        </section>
        <section id="en" style="display:none;">
            <p>Get ready to explore Lyon! Your mission: solve riddles to find iconic spots in the city and follow the footsteps of historical figures who shaped its history.</p>    
            <h2>Rules</h2>
            <p>The game is played in teams of 4 to 5 people. You will receive a starting QR code with the first riddle.</p>
            <p>At each step, you will need to:</p>
            <ul>
                <li>Solve a riddle to guess a location and a historical figure</li>
                <li>Go to that location</li>
                <li>Scan a new QR code that will give you the next clue</li>
            </ul>
            <p> You will visit 9 different locations and have to identify 6 historical figures.
                Remember the list of historical figures as it will be useful for the final step!</p>
            <h2>Goal</h2>
            <p>You need to be the first team to solve all the riddles and reach me at the final location!</p>
            <p>To help you navigate, here is a map outlining the area where the different locations are found.</p>
        </section>  

        <section id="map" style="height: 400px; margin-top: 20px;">

            
        </section>
        <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
        <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
        <script>
            // Initialize the map
            const map = L.map('map').setView([45.762043, 4.835659], 13.5); // Centered on Lyon

            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: 'Lyon Express'
            }).addTo(map);
            // Add a blue marker for the user's location
            const userMarker = L.marker([0, 0], { 
                icon: L.icon({
                    iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png',
                    iconSize: [25, 41],
                    iconAnchor: [12, 41],
                    popupAnchor: [1, -34],
                    shadowSize: [41, 41]
                }) 
            });

            // Function to locate the user and add the marker
            function locateUser() {
                map.locate({ setView: true, maxZoom: 16 });
            }

            // Update the marker when the user's location is found
            map.on('locationfound', (e) => {
                userMarker.setLatLng(e.latlng).bindPopup('You are here!').openPopup();
                if (!map.hasLayer(userMarker)) {
                    userMarker.addTo(map);
                }
            });

            // Handle location errors
            map.on('locationerror', (e) => {
                alert('Unable to retrieve your location. Please enable location services.');
            });

            // Add a custom control button to locate the user
            const locateControl = L.control({ position: 'topright' });
            locateControl.onAdd = function () {
                const button = L.DomUtil.create('button', 'locate-button');
                button.innerHTML = 'Locate Me';
                button.style.backgroundColor = 'white';
                button.style.border = '2px solid #ccc';
                button.style.padding = '5px';
                button.style.cursor = 'pointer';
                button.onclick = locateUser;
                return button;
            };
            locateControl.addTo(map);
            // Load GeoJSON data
            fetch('data/jeu-piste-lyon.geojson')
                .then(response => response.json())
                .then(data => {
                    // Add GeoJSON layer to the map
                    L.geoJSON(data, {
                        style: {
                            color: 'blue',
                            weight: 2,
                            opacity: 0.6
                        }
                    }).addTo(map);
                })
                .catch(error => console.error('Error loading GeoJSON:', error));
        </script>
        
    </main>
    <script>
        const langSwitch = document.querySelectorAll('nav a');
        langSwitch.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('fr').style.display = link.textContent === 'Français' ? 'block' : 'none';
                document.getElementById('en').style.display = link.textContent === 'English' ? 'block' : 'none';
            });
        });
    </script>
</body>
</html>